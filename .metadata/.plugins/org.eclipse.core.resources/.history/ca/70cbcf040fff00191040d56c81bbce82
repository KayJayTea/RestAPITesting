package gpath.com.tests;

import static io.restassured.RestAssured.get;
import static io.restassured.RestAssured.given;
import static org.hamcrest.Matchers.equalTo;

import java.util.ArrayList;

import org.junit.BeforeClass;
import org.junit.FixMethodOrder;
import org.junit.Test;
import org.junit.runners.MethodSorters;

import com.sun.xml.xsom.impl.scd.Iterators.Map;

import io.restassured.RestAssured;
import io.restassured.builder.RequestSpecBuilder;
import io.restassured.path.json.JsonPath;
import io.restassured.response.Response;
import io.restassured.specification.RequestSpecification;

@FixMethodOrder(MethodSorters.NAME_ASCENDING)
public class gpath_tests {
	
	@BeforeClass
	public static void setupRestAssured() {
		RestAssured.baseURI = "http://api.football-data.org";
		RestAssured.basePath = "/v2/";
		RequestSpecification requestSpecs = new RequestSpecBuilder()
				.addHeader("X-Auth-Token", "11601c3eb7e24713b163491f2782eb99")
				.addHeader("X-Response-Control", "minified")
				.build();
		
		RestAssured.requestSpecification = requestSpecs;
		
	}
	
	@Test
	public void test_001_extractSingleValue_findSingleTeamName() {
		Response response = get("teams/66");
		String teamName = response.path("name");
		System.out.println("Find a Single Team: " + teamName);
	}
	
	@Test
	public void test_002_extractSingleValue_findSingleTeamName_specifyJsonPath() {
		Response response = get("teams/66");
		JsonPath jsonPath = new JsonPath(response.asString());
		String teamName = jsonPath.get("name");
		System.out.println("Specify JsonPAth: " + teamName);
	}
	
	@Test
	public void test_003_extractSingleValue_findSingleTeamName_responseAsAString() {
		String responseAsAString = get("teams/66").asString();
		String teamName = JsonPath.from(responseAsAString).get("name");
		System.out.println("Response as a String: " + teamName);
	}
	
	@Test
	public void test_004_extractSingleValue_findSingleTeamName_getEverythingInOneGo() {
		String teamName = get("teams/66").path("name");
		System.out.println("Get everything in one go: " + teamName);
	}
	
	@Test
	public void test_005_extractSingleValue_findSingleTeamName_useAssertion() {
		given()
			.when()
			.get("teams/66")
			.then().assertThat()
			.body("name", equalTo("Manchester United FC"));
	}
	
	@Test
	public void test_006_extractFrirstValueWhenSeveralAreReturned_findFirstTeamName() {
		Response response = get("competitions");
		String firstTeamName = response.path("competitions.name[0]");
		System.out.println("First Team Name: " + firstTeamName);
	}
	
	@Test
	public void test_007_extractFrirstValueWhenSeveralAreReturned_findLastTeamName() {
		Response response = get("competitions");
		String lastTeamName = response.path("competitions.name[-1]");
		System.out.println("Last Team Name: " + lastTeamName);
	}
	
	// Extract All Values into a List
	@Test
	public void test_008_extractListOfValues_findAllTeamNames() {
		Response response = get("teams");
		ArrayList<String> allTeamNames = response.path("teams.name");
		System.out.println(allTeamNames);
	}
	
	// Extract Multiple Maps of Objects
	@Test
	public void extractListOfMapsOfElements_findAllTeamData() {
		Response response = get("teams");
		ArrayList<Map<String,?>> allTeamData = response.path("teams");
		System.out.println(allTeamData);
	}

}
